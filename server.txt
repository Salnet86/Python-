import socket
import os

# Cartella dove salvare i file ricevuti
salva_cartella = "C:/Users/TuoUtente/Desktop/ricevuti"
os.makedirs(salva_cartella, exist_ok=True)

server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server.bind(("127.0.0.1", 5000))
server.listen(1)
print("Server in ascolto...")

while True:
    conn, addr = server.accept()
    print("Client connesso:", addr)

    while True:
        # Ricevo nome file
        file_name = conn.recv(1024).decode()
        if not file_name:
            break
        conn.send(b"OK")  # conferma nome file

        # Creo file sul server
        percorso_file = os.path.join(salva_cartella, file_name)
        f = open(percorso_file, "wb")

        while True:
            data = conn.recv(1024)
            if data == b"EOF":
                break
            f.write(data)
        
        f.close()
        conn.send(b"OK")  # conferma fine file
        print("File ricevuto:", file_name)

    conn.close()
    print("Client disconnesso\n")
